/** @license
 * wat-do <https://github.com/j1i/wat-do/>
 * License: MIT
 * Author: Jacob Wirth, Justin Li
 */
function setModal(t){t?($("#modal").show(),$.each($(".modal-inner"),function(){var e=$(this);this.id==t?(e.show(),e.find("textarea").each(function(){""==e.val()&&e.val("")})):e.hide()})):$("#modal").hide()}function setFormData(t,e,s){t.data("js-data")&&(null==e?(0!=Object.keys(t.data("js-data")).length||s)&&(t.data("js-data",{}),t.find("textarea[js-data],input[js-data]").each(function(){var t=$(this);t.data("js-commit",null),"checkbox"==t.attr("type")?t.attr("checked")&&t.click():t.val("")})):(t.data("js-data")!=e||s)&&(t.data("js-data",e),t.find("textarea[js-data],input[js-data]").each(function(){var t=$(this),s=t.attr("js-data"),n="";e[s]!==void 0&&(n=e[s]),t.data("js-commit",n),"checkbox"==t.attr("type")?!!t.attr("checked")!=n&&t.click():t.val(n)})))}function showError(t){$("#modal").is(":visible")?t?alert(t):alert($("#error #defaultmsg").text()):(t?($("#error #defaultmsg").hide(),$("#error #msg").show().text(t)):($("#error #defaultmsg").show(),$("#error #msg").hide()),setModal("error"))}function makeRequest(t,e,s,n){"function"==typeof s&&(n=s,s=void 0),$.ajax({type:t,url:e,data:s,success:function(t){t?t.error?(console.log("Error: "+t.error),"no-user"===t.error&&(user=!1,handlers.setTimelineVisible(!1),handlers.lastpage="/",window.history.replaceState({watpage:"/"},"Title","/"),window.history.pushState({watpage:window.location.pathname},"Title",window.location.pathname)),showError(t.msg)):t.response?n(t.response):showError():showError()},error:function(t,e,s){"timeout"===e?showError("wat do could not connect to the server, please try again later."):(console.log("Request error: "+e+(s?" - "+s:"")),showError())}})}function timeUpdate(){gtl.rules.selectAll(".now").transition().duration(750).style("left",gtl.x(moment().diff(gtl.starttime)/36e5)+"px"),gtl.body.selectAll(".white").transition().duration(750).style("width",function(t){return Math.max(0,gtl.w(-t.rstart+moment().diff(gtl.starttime)/36e5)-1)+"px"}),gtl.body.selectAll(".item-back").attr("rend",function(t){return t.rend-moment().diff(gtl.starttime)/36e5}),gtl.body.selectAll(".item").attr("rend",function(t){return t.rend-moment().diff(gtl.starttime)/36e5})}function barsEnter(t){var e=t.append("div").attr("class","rule-wrap");e.append("div").attr("class","rule").style("left",function(t){return gtl.x(24*t-24*Math.floor(-gtl.gstart/24)+24-moment().hours())+"px"}),e.append("div").attr("class","rule-text").style("left",function(t){return gtl.x(24*t-24*Math.floor(-gtl.gstart/24)+24-moment().hours())-gtl.scale/2+"px"}).style("width",function(){return gtl.scale+"px"}).html(function(t){var e=moment().add("days",t-Math.floor(-gtl.gstart/24)+1);return e.format("ddd")+"<br/>"+e.format("MMM D")}),gtl.rules.selectAll(".now").data(d3.range(1)).enter().append("div").attr("class","now").style("left",gtl.x(0)+"px")}function barsUpdate(t){t.select(".rule").transition().duration(750).style("left",function(t){return gtl.x(24*t-24*Math.floor(-gtl.gstart/24)+24-moment().hours())+"px"}),t.select(".rule-text").html(function(t){var e=moment().add("days",t-Math.floor(-gtl.gstart/24)+1);return e.format("ddd")+"<br/>"+e.format("MMM D")}).transition().duration(750).style("left",function(t){return gtl.x(24*t-24*Math.floor(-gtl.gstart/24)+24-moment().hours())-gtl.scale/2+"px"}).style("width",function(){return gtl.scale+"px"}),gtl.rules.selectAll(".now").transition().duration(750).style("left",gtl.x(0)+"px"),gtl.body.selectAll(".white").transition().duration(750).style("width",function(t){return Math.max(0,gtl.w(-t.rstart)-1)+"px"})}function barsExit(t){t.transition().duration(750).remove()}function itemsEnter(t){var e=t.append("div").attr("class","item-wrap");e.append("div").attr("class","item-back").attr("done",function(t){return t.done}).attr("rend",function(t){return t.rend}).attr("notify",function(t){return.2>=t.rend/(t.rend-t.rstart)}).style("left",function(t){return gtl.x(t.rstart)+"px"}).style("top",function(t,e){return gtl.y(e)+45+"px"}).append("div").attr("class","white").style("width",function(t){return Math.max(0,gtl.w(-t.rstart)-1)+"px"});var s=e.append("div").attr("class","item").attr("done",function(t){return t.done}).attr("rend",function(t){return t.rend}).attr("notify",function(t){return.2>=t.rend/(t.rend-t.rstart)}).style("left",function(t){return gtl.x(t.rstart)+"px"}).style("top",function(t,e){return gtl.y(e)+45+"px"});s.append("div").attr("class","info title").attr("title",function(t){return t.name}).text(function(t){return t.name}),s.append("div").attr("class","info desc").attr("title",function(t){return t.desc}).text(function(t){return t.desc}),s.append("div").attr("class","info due").attr("title",function(t){return moment().add("hours",t.rend).calendar()}).text(function(t){return moment().add("hours",t.rend).calendar()}),s.on("click",function(t){gtl.mousestart&&2>Math.abs(d3.event.screenX-gtl.mousestart[0])&&handlers.changeURL("/item/"+t._id)})}function itemsUpdate(t){t.select(".item-back").style("top",function(t,e){return gtl.y(e)+45+"px"}).attr("done",function(t){return t.done}).attr("rend",function(t){return t.rend}).attr("notify",function(t){return.2>=t.rend/(t.rend-t.rstart)}).transition().duration(750).style("left",function(t){return gtl.x(t.rstart)+"px"}).style("width",function(t){return gtl.w(t.rend-t.rstart)+"px"}).select(".white").transition().duration(750).style("width",function(t){return Math.max(0,gtl.w(-t.rstart)-1)+"px"});var e=t.select(".item").style("top",function(t,e){return gtl.y(e)+45+"px"}).attr("done",function(t){return t.done}).attr("rend",function(t){return t.rend}).attr("notify",function(t){return.2>=t.rend/(t.rend-t.rstart)}).transition().duration(750).style("left",function(t){return gtl.x(t.rstart)+"px"}).style("width",function(t){return gtl.w(t.rend-t.rstart)+"px"});e.select(".title").attr("title",function(t){return t.name}).text(function(t){return t.name}),e.select(".desc").attr("title",function(t){return t.desc}).text(function(t){return t.desc}),e.select(".due").attr("title",function(t){return moment().add("hours",t.rend).calendar()}).text(function(t){return moment().add("hours",t.rend).calendar()})}function itemsExit(t){t.transition().duration(750).style("opacity",0).remove()}var gdata=null,_gaq=_gaq||[];_gaq.push(["_setAccount","UA-20354481-13"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),$(function(){var t=$(window),e=!1;t.scroll(function(){if(t.scrollTop()>1){if(e)return;e=!0,$("body").addClass("scroll")}else $("body").removeClass("scroll"),e=!1}),t.resize(function(){$("#modal .content").css("max-height",t.height()-80+"px"),$(".modal-inner").each(function(){var e=$(this);e.css("max-height",t.height()-80-e.outerHeight(!0)+e.height()+"px")})}),$(document).on("click","a",function(t){var e=$(this);e.attr("href")&&(t.preventDefault(),handlers.changeURL(e.attr("href")))}),$(".overlay-inner").click(function(){"/"!==window.location.pathname?!handlers.lastpage||1>=window.history.length?handlers.changeURL("/"):window.history.back():setModal()}),$(".editable").keydown(function(t){27==t.which?(t.preventDefault(),$(t.target).val($(t.target).data("js-commit")),t.target.blur()):13!=t.which||t.shiftKey||(t.preventDefault(),t.target.blur())}),$(".editable input, .editable textarea").blur(function(){$(this).data("js-commit",$(this).val())}),$("form[js-form]").each(function(){var t=$(this);t.data("js-data",{}),t.submit(function(e){e.preventDefault(),t.find("textarea[js-data],input[js-data]").each(function(){var e=$(this);t.data("js-data")[e.attr("js-data")]="checkbox"==e.attr("type")?!!e.attr("checked"):e.val()}),handlers[t.attr("js-form")](t.data("js-data"))})}),$(".btn-cancel").click(function(){setFormData($(this).parents("form[js-form]"),null,!0),$(".overlay-inner").click()}),$("input.link[readonly]").click(function(){$(this).select()}),handlers.updatePermissions(),window.onpopstate=function(t){void 0!=t.state&&void 0!=t.state.watpage&&handlers.changeURL(t.state.watpage,!0)},handlers.setupRoutes(),handlers.changeURL(window.location.pathname,!0),t.bind("mousedown",handlers.mouseDown),t.resize()});var handlers={saveList:function(t){return t.name=t.name.trim(),0>=t.name.length?(alert("You must enter a list name."),void 0):(t._id?makeRequest("POST","/list/"+t._id+".json",t,function(t){handlers.currentList===t._id&&($("#listname").text(t.name),handlers.currentName=t.name),handlers.updates.listsubs[t._id]&&(handlers.updates.listsubs[t._id].name=t.name);for(var e=0;handlers.updates.lists.length>e;e++)if(handlers.updates.lists[e]._id===t._id){handlers.updates.lists[e].name=t.name;break}$(".overlay-inner").click()}):makeRequest("POST","/list/new.json",t,function(t){handlers.updates.lists.push(t),handlers.updates.listsubs[t._id]={name:t.name,updates:0},handlers.changeURL("/list/"+t._id)}),void 0)},deleteList:function(t){confirm("Are you sure you want to delete the list: "+t.name)&&makeRequest("DELETE","/list/"+t._id+".json",function(t){handlers.updates.notifications-=handlers.updates.listsubs[t].updates,handlers.updates.listsubs[t]=void 0;for(var e=0;handlers.updates.lists.length>e;e++)if(handlers.updates.lists[e]._id===t){handlers.updates.lists.splice(e,1);break}handlers.refreshUpdates(),handlers.changeURL("/")})},saveItem:function(t){if(t.name=t.name.trim(),0>=t.name.length)return alert("You must enter an item name."),void 0;var e=moment(t.start),s=moment(t.end),n=moment();return e.isValid()&&s.isValid()?Math.abs(e.diff(n,"years",!0))>1||Math.abs(s.diff(n,"years",!0))>1?(alert("You cannot add items with dates so far away."),void 0):e.diff(s)>=0?(alert("Your item must be due after it starts."),void 0):(t.start=e.utc().format(),t.end=s.utc().format(),t._id?makeRequest("POST","/item/"+t._id+".json",t,function(t){for(var e=0;gdata.length>e;e++)if(gdata[e]._id==t.item._id){gdata[e]=t.item;break}timelineUpdate(gdata),handlers.refreshUpdates(t.updatechange),$(".overlay-inner").click()}):(t.user=handlers.currentUser,t.list=handlers.currentList,makeRequest("POST","/item/new.json",t,function(t){gdata.push(t.item),timelineUpdate(gdata),handlers.refreshUpdates(t.updatechange),$(".overlay-inner").click()})),void 0):(alert("One of the dates you entered is not valid."),void 0)},deleteItem:function(t){confirm("Are you sure you want to delete the item: "+t.name)&&makeRequest("DELETE","/item/"+t._id+".json",function(t){for(var e=0;gdata.length>e;e++)if(gdata[e]._id===t.id){gdata.splice(e,1);break}timelineUpdate(gdata),handlers.refreshUpdates(t.updatechange),$(".overlay-inner").click()})},saveAccount:function(t){return t.name=t.name.trim(),0>=t.name.length?(alert("You must enter a name."),void 0):(makeRequest("POST","/account.json",t,function(){$(".overlay-inner").click()}),void 0)},subscribe:function(t){makeRequest("POST","/updates.json",{subscribe:t,user:handlers.currentUser,list:handlers.currentList},function(t){handlers.updates=t,handlers.refreshUpdates()})},mouseDown:function(t){if($("section#timeline-wrap").is(":visible")&&!$("#modal").is(":visible")){var e=$(window);t.clientY>52&&e.width()>t.clientX&&e.height()>t.clientY&&(gtl.mousestart=[t.screenX,t.screenY],gtl.mouse=[e.scrollLeft()+gtl.mousestart[0],e.scrollTop()+gtl.mousestart[1]],e.bind("mousemove",handlers.mouseMove).bind("mouseup",handlers.mouseUp),t.preventDefault())}},mouseMove:function(t){(gtl.mouse[0]!=t.screenX||gtl.mouse[1]!=t.screenY)&&window.scrollTo(gtl.mouse[0]-t.screenX,gtl.mouse[1]-t.screenY),t.preventDefault()},mouseUp:function(t){window.scrollTo(gtl.mouse[0]-t.screenX,gtl.mouse[1]-t.screenY),t.preventDefault(),$(window).unbind("mousemove",handlers.mouseMove).unbind("mouseup",handlers.mouseUp)},lastpage:void 0,changeURL:function(t,e){crossroads.parse(t),e||(handlers.lastpage=window.location.pathname,window.history.replaceState({watpage:window.location.pathname},"Title",window.location.pathname),window.history.pushState({watpage:t},"Title",t))},setTimelineVisible:function(t){var e=$("section#timeline-wrap"),s=$("section#home");t?(e.is(":visible")||e.show(),s.is(":visible")&&s.hide(),gtl.init||timelineInit()):(e.is(":visible")&&e.hide(),s.is(":visible")||s.show())},updates:null,refreshUpdates:function(t,e){if(user){if("function"==typeof t&&(e=t,t=void 0),!handlers.updates)return makeRequest("GET","/updates.json",function(t){t&&(handlers.updates=t,handlers.refreshUpdates(e))}),void 0;var s=!1;s=handlers.currentUser?handlers.updates.usersubs[handlers.currentUser]:handlers.currentList?handlers.updates.listsubs[handlers.currentList]:handlers.updates.usersubs[handlers.updates.self],t&&(s.updates+=t,handlers.updates.notifications+=t),s?$(".subscribe").attr("subbed","subbed"):$(".subscribe").removeAttr("subbed"),$("#updates").text(handlers.updates.notifications).attr("updates",handlers.updates.notifications),e&&e()}},currentName:null,currentUser:null,currentList:null,currentPerm:-1,loadData:function(t,e,s,n){if("function"==typeof t&&(n=e,s=t,e=void 0,t=void 0),gdata&&handlers.currentUser==t&&handlers.currentList==e)return s&&n?s(n):s&&s(),void 0;var a="/items.json";t?a="/user/"+t+".json":e&&(a="/list/"+e+".json"),makeRequest("GET",a,function(a){t||e?$(".subscribe").show():$(".subscribe").hide(),$("#listname").text(a.name),handlers.currentName=a.name,handlers.currentUser=t,handlers.currentList=e,handlers.currentPerm=a.permission,handlers.updatePermissions(),handlers.refreshUpdates(),gdata=a.list,gtl.scrolled=!1,timelineUpdate(gdata),s&&n?s(n):s&&s()})},updatePermissions:function(){$("[perm]").each(function(){$this=$(this),$this.filter('input[type="text"],input[type="checkbox"],textarea').length>0?($this.attr("hasperm","hasperm"),$this.attr("perm")>handlers.currentPerm?$this.attr("readonly","readonly"):$this.removeAttr("readonly")):$this.attr("perm")>handlers.currentPerm?$this.removeAttr("hasperm"):$this.attr("hasperm","hasperm")})},setupRoutes:function(){function t(){var t=$("#item form");t.find(".btn-delete").hide(),t.find(".btn-list").hide(),setFormData(t,{start:moment().format("MMM D YYYY, h:mm a"),end:moment().add("days",7).format("MMM D YYYY, h:mm a")}),setModal("item")}function e(t){for(var e=0;gdata.length>e;e++)if(gdata[e]._id==t){gdata[e].start=moment(gdata[e].start).format("MMM D YYYY, h:mm a"),gdata[e].end=moment(gdata[e].end).format("MMM D YYYY, h:mm a");var s=$("#item form");return handlers.currentPerm>0&&s.find(".btn-delete").show(),handlers.currentList||handlers.currentUser?s.find(".btn-list").hide():s.find(".btn-list").show(),user?s.find(".btn-save").show():s.find(".btn-save").hide(),s.find(".btn-cancel").val(user?"Cancel":"Close"),setFormData(s,gdata[e]),setModal("item"),void 0}showError("The requested item does not exist.")}crossroads.addRoute("/",function(){setModal(),handlers.setTimelineVisible(user),user&&handlers.loadData()},0),crossroads.addRoute("/about",function(){setModal("about"),handlers.setTimelineVisible(user),user&&handlers.loadData(handlers.currentUser,handlers.currentList)},1),crossroads.addRoute("/account",function(){handlers.setTimelineVisible(user),user?(makeRequest("GET","/account.json",function(t){t.createdAt=moment(t.createdAt).format("MMM D YYYY, h:mm a"),t.share=window.location.protocol+"//"+window.location.host+"/user/"+t._id,setFormData($("#account form"),t),setModal("account")}),handlers.loadData(handlers.currentUser,handlers.currentList)):showError("You must be logged in to view this page.")},1),crossroads.addRoute("/updates",function(){handlers.setTimelineVisible(user),user?handlers.refreshUpdates(function(){handlers.populateUpdates(),setModal("updates"),handlers.loadData(handlers.currentUser,handlers.currentList)}):showError("You must be logged in to view this page.")},1),crossroads.addRoute("/list/new",function(){if(handlers.setTimelineVisible(user),user){var t=$("#list form");t.find(".btn-delete").hide(),t.find("#sharelink").hide(),setFormData(t),$("#list #members-list").html(""),setModal("list"),handlers.loadData(handlers.currentUser,handlers.currentList)}else showError("You must be logged in to create new lists.")},2),crossroads.addRoute("/list/{id}/edit",function(t){handlers.setTimelineVisible(user),user?(makeRequest("GET","/list/"+t+".json",function(t){if(2>t.permission)return showError("You do not have permission to edit this list."),void 0;t.share=window.location.protocol+"//"+window.location.host+"/list/"+t._id;var e=$("#list form");t.permission>2&&e.find(".btn-delete").show(),e.find("#sharelink").show(),setFormData(e,t),handlers.populateListMembers(t),setModal("list")}),handlers.loadData(null,t)):showError("You must be logged in to edit lists.")},2),crossroads.addRoute("/list/{id}",function(t){setModal(),handlers.setTimelineVisible(!0),handlers.loadData(null,t)},1),crossroads.addRoute("/user/{id}",function(t){setModal(),handlers.setTimelineVisible(!0),handlers.loadData(t)},1),crossroads.addRoute("/item/new",function(){handlers.setTimelineVisible(user),user?handlers.loadData(handlers.currentUser,handlers.currentList,t):showError("You must be logged in to create new items.")},2),crossroads.addRoute("/item/{id}",function(t){handlers.setTimelineVisible(!0),gdata?handlers.loadData(handlers.currentUser,handlers.currentList,e,t):makeRequest("GET","/item/"+t+".json",function(s){handlers.loadData(s.user,s.list,function(){s.user?(handlers.lastpage="/user/"+s.user,window.history.replaceState({watpage:"/user/"+s.user},"Title","/user/"+s.user),window.history.pushState({watpage:"/item/"+t},"Title","/item/"+t)):s.list&&(handlers.lastpage="/list/"+s.list,window.history.replaceState({watpage:"/list/"+s.list},"Title","/list/"+s.list),window.history.pushState({watpage:"/item/"+t},"Title","/item/"+t)),e(t)})})},1),crossroads.bypassed.add(function(t){window.location.pathname!=t&&(window.location=t)})},populateUpdates:function(){var t=[];t.push({name:"Your List"}),t.concat(handlers.updates.lists);var e=d3.select("#updates #lists").selectAll("li").data(t),t=e.enter().append("li").append("a").attr("href",function(t){return t._id?"/list/"+t._id:"/user/"+handlers.updates.self});if(t.append("span").text(function(t){return t.name}),t.append("div").attr("class","updates").attr("updates",function(t){return t._id?handlers.updates.listsubs[t._id]?handlers.updates.listsubs[t._id].updates:0:handlers.updates.usersubs[handlers.updates.self]?handlers.updates.usersubs[handlers.updates.self].updates:0}).text(function(t){return t._id?handlers.updates.listsubs[t._id]?handlers.updates.listsubs[t._id].updates:0:handlers.updates.usersubs[handlers.updates.self]?handlers.updates.usersubs[handlers.updates.self].updates:0}),t=e.select("a").attr("href",function(t){return t._id?"/list/"+t._id:"/user/"+handlers.updates.self}),t.select("span").text(function(t){return t.name}),t.select("div").attr("updates",function(t){return t._id?handlers.updates.listsubs[t._id]?handlers.updates.listsubs[t._id].updates:0:handlers.updates.usersubs[handlers.updates.self]?handlers.updates.usersubs[handlers.updates.self].updates:0}).text(function(t){return t._id?handlers.updates.listsubs[t._id]?handlers.updates.listsubs[t._id].updates:0:handlers.updates.usersubs[handlers.updates.self]?handlers.updates.usersubs[handlers.updates.self].updates:0}),e.exit().remove(),0>=handlers.updates.usersubs.length&&0>=handlers.updates.listsubs.length)$("#updates #usersubs").html('<li><a><span>None</span><div class="updates"></div></a></li>'),$("#updates #listsubs").html("");else{var s=[];for(var n in handlers.updates.usersubs)handlers.updates.usersubs[n]&&s.push({_id:n,link:"/user/"+n,sub:handlers.updates.usersubs[n]});for(var n in handlers.updates.listsubs)handlers.updates.listsubs[n]&&s.push({_id:n,link:"/list/"+n,sub:handlers.updates.listsubs[n]});var a=d3.select("#updates #listsubs").selectAll("li").data(s),t=a.enter().append("li").append("a").attr("href",function(t){return t.link});t.append("span").text(function(t){return t.sub.name}),t.append("div").attr("class","updates").attr("updates",function(t){return t.sub.updates}).text(function(t){return t.sub.updates}),t=a.select("a").attr("href",function(t){return t.link}),t.select("span").text(function(t){return t.sub.name}),t.select("div").attr("updates",function(t){return t.sub.updates}).text(function(t){return t.sub.updates}),a.exit().remove()}},populateListMembers:function(t){var e=d3.select("#list #members-list").selectAll("tr").data(t.members),s=e.enter().append("tr");s.append("td").attr("class","left").text("X").on("click",function(e,s){t.members.splice(s,1),$("#list form").data("js-data",t),handlers.populateListMembers(t)}),s.append("td").attr("class","email").append("p").text(function(t){return t.user.email}),s=s.append("td").attr("class","right").append("select").attr("class","permission medium").on("change",function(e){e.permission=$(d3.event.target).val(),$("#list form").data("js-data",t)}),s.append("option").attr("class","option0").attr("value","0").attr("selected",function(t){return 0==t.permission?"selected":void 0}).text("View Only"),s.append("option").attr("class","option1").attr("value","1").attr("selected",function(t){return 1==t.permission?"selected":void 0}).text("View & Edit"),s.append("option").attr("class","option2").attr("value","2").attr("selected",function(t){return 2==t.permission?"selected":void 0}).text("Admin"),e.select(".email p").text(function(t){return t.user.email}),e.select(".right option0").attr("selected",function(t){return 0==t.permission?"selected":void 0}),e.select(".right option1").attr("selected",function(t){return 1==t.permission?"selected":void 0}),e.select(".right option2").attr("selected",function(t){return 2==t.permission?"selected":void 0}),e.exit().remove()}},gtl={init:!1,scale:100,mouse:null,mousestart:null,scrolled:!1},timelineInit=function(){gtl.x=d3.scale.linear().range([0,gtl.scale]),gtl.w=d3.scale.linear().range([0,gtl.scale]).domain([0,24]),gtl.y=d3.scale.linear(),gtl.main=d3.select(".timeline-visualization").attr("style","height:"+screen.height+"px;"),gtl.timeline=gtl.main.append("div").attr("id","timeline"),gtl.rules=gtl.timeline.append("div").attr("id","tlrules"),gtl.body=gtl.timeline.append("div").attr("id","tlbody"),$("#done").click(function(){$('input[name="item-done"]').click()}),$('input[name="item-done"]').click(function(t){t.preventDefault();var e=$(this);user&&(e.attr("checked")?(e.attr("checked",!1),$("#done").removeClass("done")):(e.attr("checked",!0),$("#done").addClass("done"))),e.blur()}).attr("checked",!1);var t=$("#item form");t.find(".btn-delete").click(function(){handlers.deleteItem(t.data("js-data"))}),t.find(".btn-list").click(function(){console.log("Go to List")});var e=$("#list form");e.find(".btn-delete").click(function(){handlers.deleteList(e.data("js-data"))}),$("#editlist").click(function(t){t.preventDefault(),handlers.changeURL("/list/"+handlers.currentList+"/edit")}),$(".subscribe").click(function(t){t.preventDefault();var e=$(this);e.attr("subbed")?e.removeAttr("subbed"):e.attr("subbed","subbed"),handlers.subscribe(!!e.attr("subbed"))}),$("#list #adduser").click(function(t){t.preventDefault();for(var e=$("#list form"),s=e.find("#email").val(),n=e.find("#members-head .permission").val(),a=e.data("js-data"),r=0;a.members.length>r;r++)if(a.members[r].user.email===s)return alert("This user is already added to the list."),void 0;makeRequest("POST","/email.json",{email:s},function(t){a.members.push({permission:n,user:t}),handlers.populateListMembers(a)})}),gtl.init=!0,setInterval(timeUpdate,1e3)},timelineUpdate=function(t){if(gtl.init||timelineInit(),!t)return showError(),void 0;var e=moment();gtl.starttime=e;for(var s=0;t.length>s;++s)t[s].rstart=moment(t[s].start).diff(e)/36e5,t[s].rend=moment(t[s].end).diff(e)/36e5;gtl.gstart=Math.min(0,d3.min(t,function(t){return t.rstart})),gtl.gend=Math.max(0,d3.max(t,function(t){return t.rend})),isNaN(gtl.gstart)&&(gtl.gstart=0),isNaN(gtl.gend)&&(gtl.gend=0),gtl.gstart-=24*(screen.width/gtl.scale),gtl.gend+=24*(screen.width/gtl.scale);var n=70*t.length;gtl.main.attr("style","height:"+(n+50)+"px;"),gtl.y.range([0,n]),gtl.x.domain([gtl.gstart,gtl.gstart+24]),gtl.y.domain([0,t.length]);var a=gtl.rules.selectAll(".rule-wrap").data(d3.range(Math.floor((gtl.gend-gtl.gstart)/24)));barsEnter(a.enter()),barsUpdate(a),barsExit(a.exit());var r=gtl.body.selectAll(".item-wrap").data(t.sort(function(t,e){if(t.done==e.done){var s=t.rend/(t.rend-t.rstart),n=e.rend/(e.rend-e.rstart),a=s>n?1:s==n?0:-1;return t.done?-a:a}return t.done?1:-1}),function(t){return t._id});itemsEnter(r.enter()),itemsUpdate(r),itemsExit(r.exit()),gtl.mouse||gtl.scrolled||($(window).scrollLeft(gtl.x(0)-$(window).width()/2),gtl.scrolled=!0)};